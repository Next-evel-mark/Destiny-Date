<!DOCTYPE html>
<html>
<head>
    <title>Destiny Date</title>
</head>
<body>
<h1>Destiny Date</h1>

<h2>Register</h2>
<form id="registerForm">
    Email: <input type="email" id="email"> or Phone: <input type="text" id="phone"><br>
    Password: <input type="password" id="password"><br>
    <button type="submit">Register</button>
</form>

<h2>Verify</h2>
<form id="verifyForm">
    Email or Phone: <input type="text" id="verifyUser"><br>
    Code: <input type="text" id="code"><br>
    <button type="submit">Verify</button>
</form>

<h2>Set Profile</h2>
<form id="profileForm">
    Email or Phone: <input type="text" id="profileUser"><br>
    Username: <input type="text" id="username"><br>
    Profile Picture Filename (optional): <input type="text" id="profilePic"><br>
    <button type="submit">Set Profile</button>
</form>

<h2>Search Users</h2>
<form id="searchForm">
    Username Contains: <input type="text" id="searchUsername">
    <button type="submit">Search</button>
</form>
<ul id="results"></ul>

<script>
    const baseUrl = "http://localhost:8080/api/users";

    document.getElementById('registerForm').onsubmit = async e => {
        e.preventDefault();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!password) {
            alert("Password required");
            return;
        }
        if (!email && !phone) {
            alert("Email or Phone required");
            return;
        }

        let params = new URLSearchParams();
        if(email) params.append("email", email);
        if(phone) params.append("phone", phone);
        params.append("password", password);

        const res = await fetch(baseUrl + "/register?" + params.toString(), { method: "POST" });
        alert(await res.text());
    };

    document.getElementById('verifyForm').onsubmit = async e => {
        e.preventDefault();
        const user = document.getElementById('verifyUser').value.trim();
        const code = document.getElementById('code').value.trim();

        if(!user || !code){
            alert("Email/Phone and code required");
            return;
        }

        const params = new URLSearchParams({emailOrPhone: user, code});

        const res = await fetch(baseUrl + "/verify?" + params.toString(), { method: "POST" });
        alert(await res.text());
    };

    document.getElementById('profileForm').onsubmit = async e => {
        e.preventDefault();
        const user = document.getElementById('profileUser').value.trim();
        const username = document.getElementById('username').value.trim();
        const profilePic = document.getElementById('profilePic').value.trim();

        if(!user || !username){
            alert("Email/Phone and username required");
            return;
        }

        let params = new URLSearchParams({emailOrPhone: user, username});
        if(profilePic) params.append("profilePictureFilename", profilePic);

        const res = await fetch(baseUrl + "/profile?" + params.toString(), { method: "POST" });
        alert(await res.text());
    };

    document.getElementById('searchForm').onsubmit = async e => {
        e.preventDefault();
        const username = document.getElementById('searchUsername').value.trim();

        if(!username){
            alert("Search username required");
            return;
        }

        const res = await fetch(baseUrl + "/search?username=" + encodeURIComponent(username));
        if (res.ok) {
            const users = await res.json();
            const results = document.getElementById('results');
            results.innerHTML = "";
            if(users.length === 0){
                results.innerHTML = "<li>No users found</li>";
            }
            users.forEach(u => {
                let li = document.createElement('li');
                li.textContent = `Username: ${u.username}, Email: ${u.email ? u.email : 'N/A'}, Phone: ${u.phoneNumber ? u.phoneNumber : 'N/A'}`;
                results.appendChild(li);
            });
        } else {
            alert("Error loading users");
        }
    };
</script>

</body>
</html>
